<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CNN Architecture Visualizer</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap');

  :root {
    --bg: #050810;
    --surface: #0d1220;
    --border: #1a2540;
    --input-col: #00e5ff;
    --conv-col: #ff6b35;
    --pool-col: #ffd700;
    --fc-col: #a855f7;
    --output-col: #4ade80;
    --text: #e2e8f0;
    --dim: #64748b;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Space Mono', monospace;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* Starfield bg */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      radial-gradient(1px 1px at 10% 20%, rgba(255,255,255,0.3) 0%, transparent 100%),
      radial-gradient(1px 1px at 30% 60%, rgba(255,255,255,0.2) 0%, transparent 100%),
      radial-gradient(1px 1px at 70% 10%, rgba(255,255,255,0.3) 0%, transparent 100%),
      radial-gradient(1px 1px at 90% 80%, rgba(255,255,255,0.2) 0%, transparent 100%),
      radial-gradient(1px 1px at 50% 40%, rgba(255,255,255,0.15) 0%, transparent 100%);
    pointer-events: none;
    z-index: 0;
  }

  .header {
    padding: 40px 60px 20px;
    position: relative;
    z-index: 1;
  }

  .title {
    font-family: 'Syne', sans-serif;
    font-size: 11px;
    font-weight: 700;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--dim);
    margin-bottom: 8px;
  }

  h1 {
    font-family: 'Syne', sans-serif;
    font-size: clamp(28px, 4vw, 48px);
    font-weight: 800;
    line-height: 1.1;
    background: linear-gradient(135deg, #fff 0%, var(--input-col) 50%, var(--conv-col) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .subtitle {
    margin-top: 8px;
    font-size: 11px;
    color: var(--dim);
    letter-spacing: 0.1em;
  }

  /* Main canvas area */
  .canvas-wrap {
    position: relative;
    z-index: 1;
    padding: 20px 40px;
    overflow-x: auto;
  }

  .architecture {
    display: flex;
    align-items: center;
    gap: 0;
    min-width: 900px;
    padding: 40px 20px;
  }

  /* Layer groups */
  .layer-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    animation: fadeUp 0.6s ease both;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Stagger delays */
  .layer-group:nth-child(1) { animation-delay: 0.0s; }
  .layer-group:nth-child(2) { animation-delay: 0.1s; }
  .layer-group:nth-child(3) { animation-delay: 0.2s; }
  .layer-group:nth-child(4) { animation-delay: 0.3s; }
  .layer-group:nth-child(5) { animation-delay: 0.35s; }
  .layer-group:nth-child(6) { animation-delay: 0.4s; }
  .layer-group:nth-child(7) { animation-delay: 0.45s; }
  .layer-group:nth-child(8) { animation-delay: 0.5s; }
  .layer-group:nth-child(9) { animation-delay: 0.55s; }
  .layer-group:nth-child(10) { animation-delay: 0.6s; }

  /* 3D feature maps */
  .feature-map {
    position: relative;
    cursor: pointer;
    transition: transform 0.3s ease;
  }
  .feature-map:hover { transform: scale(1.05) translateY(-4px); }

  .fm-stack {
    position: relative;
    display: flex;
    align-items: flex-end;
  }

  .fm-face {
    position: absolute;
    border: 1.5px solid;
    border-radius: 2px;
  }

  /* Arrow connector */
  .arrow {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    padding: 0 4px;
    position: relative;
    top: -20px; /* align with map center */
  }

  .arrow-line {
    height: 1.5px;
    background: linear-gradient(90deg, var(--border), #2a3a5c);
    position: relative;
    overflow: visible;
  }

  .arrow-line::after {
    content: '▶';
    position: absolute;
    right: -6px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 7px;
    color: var(--dim);
  }

  /* Layer label */
  .layer-label {
    margin-top: 12px;
    text-align: center;
  }

  .layer-name {
    font-family: 'Syne', sans-serif;
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }

  .layer-dim {
    font-size: 9px;
    color: var(--dim);
    margin-top: 2px;
  }

  /* Fully connected section */
  .fc-section {
    display: flex;
    align-items: center;
    gap: 0;
  }

  .fc-column {
    display: flex;
    flex-direction: column;
    gap: 4px;
    position: relative;
    cursor: pointer;
    transition: transform 0.3s ease;
  }
  .fc-column:hover { transform: scale(1.05); }

  .fc-node {
    width: 14px;
    height: 14px;
    border-radius: 50%;
    border: 1.5px solid;
    transition: all 0.3s ease;
  }

  /* Info panel */
  .info-panel {
    position: relative;
    z-index: 1;
    margin: 10px 40px 40px;
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 12px;
  }

  .info-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 16px;
    position: relative;
    overflow: hidden;
    transition: border-color 0.3s ease;
  }

  .info-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
  }

  .info-card:hover { border-color: #2a3a5c; }

  .info-card.input::before { background: var(--input-col); }
  .info-card.conv::before { background: var(--conv-col); }
  .info-card.pool::before { background: var(--pool-col); }
  .info-card.fc::before { background: var(--fc-col); }
  .info-card.output::before { background: var(--output-col); }

  .card-type {
    font-size: 9px;
    font-weight: 700;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    margin-bottom: 6px;
  }
  .info-card.input .card-type { color: var(--input-col); }
  .info-card.conv .card-type { color: var(--conv-col); }
  .info-card.pool .card-type { color: var(--pool-col); }
  .info-card.fc .card-type { color: var(--fc-col); }
  .info-card.output .card-type { color: var(--output-col); }

  .card-title {
    font-family: 'Syne', sans-serif;
    font-size: 13px;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .card-desc {
    font-size: 9px;
    color: var(--dim);
    line-height: 1.5;
  }

  /* Signal animation */
  @keyframes pulse-glow {
    0%, 100% { opacity: 0.7; }
    50% { opacity: 1; filter: brightness(1.3); }
  }

  .animated-layer {
    animation: pulse-glow 3s ease-in-out infinite;
  }

  /* Tooltip */
  .tooltip {
    position: fixed;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px 14px;
    font-size: 10px;
    pointer-events: none;
    z-index: 100;
    opacity: 0;
    transition: opacity 0.2s;
    max-width: 200px;
  }
  .tooltip.visible { opacity: 1; }
  .tooltip-title { font-family: 'Syne', sans-serif; font-weight: 700; margin-bottom: 4px; }
  .tooltip-text { color: var(--dim); line-height: 1.5; }

  /* Legend */
  .legend {
    display: flex;
    gap: 20px;
    padding: 0 40px 30px;
    flex-wrap: wrap;
    position: relative;
    z-index: 1;
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 10px;
    color: var(--dim);
  }

  .legend-dot {
    width: 10px;
    height: 10px;
    border-radius: 2px;
  }
</style>
</head>
<body>

<div class="header">
  <div class="title">Deep Learning · Architecture</div>
  <h1>Convolutional Neural Network</h1>
  <div class="subtitle">LeNet-style image classifier // hover layers for details</div>
</div>

<div class="canvas-wrap">
  <div class="architecture" id="architecture">
    <!-- Rendered by JS -->
  </div>
</div>

<div class="legend">
  <div class="legend-item"><div class="legend-dot" style="background:var(--input-col)"></div>Input</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--conv-col)"></div>Convolution + ReLU</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--pool-col)"></div>Max Pooling</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--fc-col)"></div>Fully Connected</div>
  <div class="legend-item"><div class="legend-dot" style="background:var(--output-col)"></div>Output (Softmax)</div>
</div>

<div class="info-panel">
  <div class="info-card input">
    <div class="card-type">Layer 0</div>
    <div class="card-title">Input Image</div>
    <div class="card-desc">32×32×3 RGB tensor. Pixel values normalized to [0,1].</div>
  </div>
  <div class="info-card conv">
    <div class="card-type">Layers 1 & 3</div>
    <div class="card-title">Conv + ReLU</div>
    <div class="card-desc">3×3 kernels slide over input, computing dot products. ReLU introduces non-linearity.</div>
  </div>
  <div class="info-card pool">
    <div class="card-type">Layers 2 & 4</div>
    <div class="card-title">Max Pooling</div>
    <div class="card-desc">2×2 windows. Retains maximum activation. Reduces spatial dimensions by 2×.</div>
  </div>
  <div class="info-card fc">
    <div class="card-type">Layers 5 & 6</div>
    <div class="card-title">Fully Connected</div>
    <div class="card-desc">Every neuron connected to all inputs. Learns global feature combinations.</div>
  </div>
  <div class="info-card output">
    <div class="card-type">Layer 7</div>
    <div class="card-title">Softmax Output</div>
    <div class="card-desc">10 class probabilities summing to 1. Highest activation = predicted class.</div>
  </div>
</div>

<div class="tooltip" id="tooltip">
  <div class="tooltip-title" id="tt-title"></div>
  <div class="tooltip-text" id="tt-text"></div>
</div>

<script>
const arch = document.getElementById('architecture');
const tooltip = document.getElementById('tooltip');

// Layer definitions
const layers = [
  {
    type: 'input', label: 'INPUT', dim: '32×32×3',
    color: '#00e5ff', depth: 3, w: 36, h: 80,
    tip: 'Input: 32×32×3', desc: 'RGB image tensor. 3 channels (R, G, B), each 32×32 pixels. 3,072 total values.'
  },
  {
    type: 'conv', label: 'CONV1', dim: '30×30×32',
    color: '#ff6b35', depth: 8, w: 32, h: 74,
    tip: 'Conv Layer 1', desc: '32 filters, 3×3 kernel, stride 1. Extracts low-level features: edges, colors, gradients.'
  },
  {
    type: 'pool', label: 'POOL1', dim: '15×15×32',
    color: '#ffd700', depth: 8, w: 24, h: 56,
    tip: 'Max Pool 1', desc: '2×2 pool, stride 2. Spatial dims halved. Translation invariance + computation reduction.'
  },
  {
    type: 'conv', label: 'CONV2', dim: '13×13×64',
    color: '#ff6b35', depth: 12, w: 22, h: 50,
    tip: 'Conv Layer 2', desc: '64 filters, 3×3 kernel. Learns mid-level features: textures, patterns, shapes.'
  },
  {
    type: 'pool', label: 'POOL2', dim: '6×6×64',
    color: '#ffd700', depth: 12, w: 16, h: 36,
    tip: 'Max Pool 2', desc: '2×2 pool, stride 2. Feature maps reduced to 6×6. 2,304 values flattened.'
  },
  {
    type: 'fc', label: 'FC1', dim: '512',
    color: '#a855f7', nodes: 8,
    tip: 'FC Layer 1', desc: '512 neurons. Flattened 2,304 inputs × 512 weights = ~1.2M parameters.'
  },
  {
    type: 'fc', label: 'FC2', dim: '128',
    color: '#a855f7', nodes: 6,
    tip: 'FC Layer 2', desc: '128 neurons. Dropout applied during training (p=0.5) to prevent overfitting.'
  },
  {
    type: 'output', label: 'OUTPUT', dim: '10',
    color: '#4ade80', nodes: 4,
    tip: 'Softmax Output', desc: '10 classes (CIFAR-10). Softmax converts raw logits to probabilities summing to 1.'
  }
];

function makeFeatureMap(layer, idx) {
  const wrap = document.createElement('div');
  wrap.className = 'layer-group';

  const fm = document.createElement('div');
  fm.className = 'feature-map animated-layer';
  fm.style.animationDelay = `${idx * 0.4}s`;

  const { color, depth, w, h } = layer;
  const stackDiv = document.createElement('div');
  stackDiv.className = 'fm-stack';

  const offset = 3;
  const totalW = w + offset * Math.min(depth, 6);
  const totalH = h + offset * Math.min(depth, 6) / 2;
  stackDiv.style.width = totalW + 'px';
  stackDiv.style.height = totalH + 'px';

  const count = Math.min(depth, 7);
  for (let i = count - 1; i >= 0; i--) {
    const face = document.createElement('div');
    face.className = 'fm-face';
    face.style.cssText = `
      width: ${w}px;
      height: ${h}px;
      left: ${i * offset}px;
      bottom: ${i * (offset / 2)}px;
      border-color: ${color};
      background: ${hexToRgba(color, 0.04 + i * 0.01)};
      box-shadow: inset 0 0 8px ${hexToRgba(color, 0.1)};
    `;
    if (i === count - 1) {
      face.style.background = hexToRgba(color, 0.08);
      // Add scanlines effect on front face
      face.style.backgroundImage = `repeating-linear-gradient(0deg, transparent, transparent 3px, ${hexToRgba(color, 0.03)} 3px, ${hexToRgba(color, 0.03)} 4px)`;
    }
    stackDiv.appendChild(face);
  }

  fm.appendChild(stackDiv);
  addTooltip(fm, layer);

  const label = makeLabel(layer);
  wrap.appendChild(fm);
  wrap.appendChild(label);
  return wrap;
}

function makeFCLayer(layer, idx) {
  const wrap = document.createElement('div');
  wrap.className = 'layer-group';

  const col = document.createElement('div');
  col.className = 'fc-column animated-layer';
  col.style.animationDelay = `${idx * 0.4}s`;

  const count = layer.nodes;
  for (let i = 0; i < count; i++) {
    const node = document.createElement('div');
    node.className = 'fc-node';
    node.style.borderColor = layer.color;
    node.style.background = hexToRgba(layer.color, 0.12);
    node.style.boxShadow = `0 0 6px ${hexToRgba(layer.color, 0.25)}`;
    col.appendChild(node);
  }
  // dots for more
  const more = document.createElement('div');
  more.style.cssText = `font-size:10px; color:var(--dim); text-align:center; margin-top:2px; letter-spacing:2px;`;
  more.textContent = '···';
  col.appendChild(more);

  addTooltip(col, layer);

  const label = makeLabel(layer);
  wrap.appendChild(col);
  wrap.appendChild(label);
  return wrap;
}

function makeLabel(layer) {
  const label = document.createElement('div');
  label.className = 'layer-label';
  label.innerHTML = `<div class="layer-name" style="color:${layer.color}">${layer.label}</div><div class="layer-dim">${layer.dim}</div>`;
  return label;
}

function makeArrow(w = 28) {
  const wrap = document.createElement('div');
  wrap.className = 'arrow';
  const line = document.createElement('div');
  line.className = 'arrow-line';
  line.style.width = w + 'px';
  wrap.appendChild(line);
  return wrap;
}

function addTooltip(el, layer) {
  el.addEventListener('mousemove', (e) => {
    document.getElementById('tt-title').textContent = layer.tip;
    document.getElementById('tt-text').textContent = layer.desc;
    tooltip.style.left = (e.clientX + 14) + 'px';
    tooltip.style.top = (e.clientY - 10) + 'px';
    tooltip.classList.add('visible');
  });
  el.addEventListener('mouseleave', () => tooltip.classList.remove('visible'));
}

function hexToRgba(hex, alpha) {
  const r = parseInt(hex.slice(1,3),16);
  const g = parseInt(hex.slice(3,5),16);
  const b = parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${alpha})`;
}

// Build
layers.forEach((layer, idx) => {
  if (idx > 0) arch.appendChild(makeArrow(layer.type === 'fc' ? 20 : 18));

  if (layer.type === 'fc' || layer.type === 'output') {
    arch.appendChild(makeFCLayer(layer, idx));
  } else {
    arch.appendChild(makeFeatureMap(layer, idx));
  }
});

// Hover glow on fc nodes
document.querySelectorAll('.fc-column').forEach(col => {
  col.addEventListener('mouseenter', () => {
    col.querySelectorAll('.fc-node').forEach((n, i) => {
      n.style.transitionDelay = `${i * 30}ms`;
      n.style.transform = 'scale(1.3)';
      n.style.filter = 'brightness(1.5)';
    });
  });
  col.addEventListener('mouseleave', () => {
    col.querySelectorAll('.fc-node').forEach(n => {
      n.style.transform = '';
      n.style.filter = '';
    });
  });
});
</script>
</body>
</html>
